<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>d47fe69b65f546cf9146c7e43cb229be</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<section id="predict-bike-sharing-demand-with-autogluon-template"
class="cell markdown" id="bQFYOV8M0NCb">
<h1>Predict Bike Sharing Demand with AutoGluon Template</h1>
</section>
<section id="project-predict-bike-sharing-demand-with-autogluon"
class="cell markdown" id="c46_CQmf0NCn">
<h2>Project: Predict Bike Sharing Demand with AutoGluon</h2>
<p>This notebook is a template with each step that you need to complete
for the project.</p>
<p>Please fill in your code where there are explicit <code>?</code>
markers in the notebook. You are welcome to add more cells and code as
you see fit.</p>
<p>Once you have completed all the code implementations, please export
your notebook as a HTML file so the reviews can view your code. Make
sure you have all outputs correctly outputted.</p>
<p><code>File-&gt; Export Notebook As... -&gt; Export Notebook as HTML</code></p>
<p>There is a writeup to complete as well after all code implememtation
is done. Please answer all questions and attach the necessary tables and
charts. You can complete the writeup in either markdown or PDF.</p>
<p>Completing the code template and writeup template will cover all of
the rubric points for this project.</p>
<p>The rubric contains "Stand Out Suggestions" for enhancing the project
beyond the minimum requirements. The stand out suggestions are optional.
If you decide to pursue the "stand out suggestions", you can include the
code in this notebook and also discuss the results in the writeup
file.</p>
</section>
<section id="step-1-create-an-account-with-kaggle" class="cell markdown"
id="Yv01WXzV0NCp">
<h2>Step 1: Create an account with Kaggle</h2>
</section>
<section id="create-kaggle-account-and-download-api-key"
class="cell markdown" id="137ui5fu0NCq">
<h3>Create Kaggle Account and download API key</h3>
<p>Below is example of steps to get the API username and key. Each
student will have their own username and key.</p>
</section>
<div class="cell markdown" id="SQq-s-Ix0NCr">
<ol>
<li><p>Open account settings.</p></li>
<li><p>Scroll down to API and click Create New API Token.</p></li>
<li><p>Open up <code>kaggle.json</code> and use the username and
key.</p></li>
</ol>
</div>
<section
id="step-2-download-the-kaggle-dataset-using-the-kaggle-python-library"
class="cell markdown" id="J6GeDQ0x0NCs">
<h2>Step 2: Download the Kaggle dataset using the kaggle python
library</h2>
</section>
<section id="open-up-sagemaker-studio-and-use-starter-template"
class="cell markdown" id="7Jk_bgEA0NCt">
<h3>Open up Sagemaker Studio and use starter template</h3>
</section>
<div class="cell markdown" id="DXG_ffVZ0NCu">
<ol>
<li>Notebook should be using a <code>ml.t3.medium</code> instance (2
vCPU + 4 GiB)</li>
<li>Notebook should be using kernal:
<code>Python 3 (MXNet 1.8 Python 3.7 CPU Optimized)</code></li>
</ol>
</div>
<section id="install-packages" class="cell markdown" id="NGbfikx00NCv">
<h3>Install packages</h3>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000}"
id="XGLNtkwf0NCx" data-outputId="b50ab30c-d250-4a4d-8d01-707fb5ff271e">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>U pip</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>U setuptools wheel</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">-</span>U <span class="st">&quot;mxnet&lt;2.0.0&quot;</span> bokeh<span class="op">==</span><span class="fl">2.0.1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install autogluon <span class="op">--</span>no<span class="op">-</span>cache<span class="op">-</span><span class="bu">dir</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Without --no-cache-dir, smaller aws instances may have trouble installing</span></span></code></pre></div>
</div>
<section id="setup-kaggle-api-key" class="cell markdown"
id="Hf0pwJsH0NCy">
<h3>Setup Kaggle API Key</h3>
</section>
<div class="cell code" data-execution_count="1" id="MRXcu0Tr0NCz">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create the .kaggle directory and an empty kaggle.json file</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>mkdir <span class="op">-</span>p <span class="op">/</span>root<span class="op">/</span>.kaggle</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>touch <span class="op">/</span>root<span class="op">/</span>.kaggle<span class="op">/</span>kaggle.json</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>chmod <span class="dv">600</span> <span class="op">/</span>root<span class="op">/</span>.kaggle<span class="op">/</span>kaggle.json</span></code></pre></div>
<div class="output stream stderr">
<pre><code>The syntax of the command is incorrect.
&#39;touch&#39; is not recognized as an internal or external command,
operable program or batch file.
&#39;chmod&#39; is not recognized as an internal or external command,
operable program or batch file.
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="3" id="I8IC9Cu80NCz">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill in your user name and key from creating the kaggle account and API token file</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> json</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>kaggle_username <span class="op">=</span> <span class="st">&quot;----&quot;</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>kaggle_key <span class="op">=</span> <span class="st">&quot;---&quot;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Save API token the kaggle.json file</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">&quot;/root/.kaggle/kaggle.json&quot;</span>, <span class="st">&quot;w&quot;</span>) <span class="im">as</span> f:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    f.write(json.dumps({<span class="st">&quot;username&quot;</span>: kaggle_username, <span class="st">&quot;key&quot;</span>: kaggle_key}))</span></code></pre></div>
</div>
<section id="download-and-explore-dataset" class="cell markdown"
id="7-lPalgV0NC0">
<h3>Download and explore dataset</h3>
</section>
<section
id="go-to-the-bike-sharing-demand-competition-and-agree-to-the-terms"
class="cell markdown" id="tABgGA8Z0NC0">
<h3>Go to the bike sharing demand competition and agree to the
terms</h3>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="YEZANp8a0NC1" data-outputId="fbc58efc-4c77-4a66-f25b-cd08638fa97b">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Download the dataset, it will be in a .zip file so you&#39;ll need to unzip it as well.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions download <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># If you already downloaded it you can use the -o command to overwrite the file</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>unzip <span class="op">-</span>o bike<span class="op">-</span>sharing<span class="op">-</span>demand.<span class="bu">zip</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="2" id="lhFf_mB40NC1">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> autogluon.tabular <span class="im">import</span> TabularPredictor</span></code></pre></div>
<div class="output stream stderr">
<pre><code>c:\Users\DELL\AppData\Local\Programs\Python\Python311\Lib\site-packages\tqdm\auto.py:21: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html
  from .autonotebook import tqdm as notebook_tqdm
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="3"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="Ba4Qi4An0NC1" data-outputId="722968be-07e6-473f-8821-cc83e9c7f471">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the train dataset in pandas by reading the csv</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parsing of the datetime column so you can use some of the `dt` features in pandas later</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">&#39;train.csv&#39;</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>train.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="3">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-01 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-01 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-01 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-01 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-01 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="4" id="vu7V1UGZ0NC2">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>train.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="4">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.00000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
      <td>10886.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2.506614</td>
      <td>0.028569</td>
      <td>0.680875</td>
      <td>1.418427</td>
      <td>20.23086</td>
      <td>23.655084</td>
      <td>61.886460</td>
      <td>12.799395</td>
      <td>36.021955</td>
      <td>155.552177</td>
      <td>191.574132</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.116174</td>
      <td>0.166599</td>
      <td>0.466159</td>
      <td>0.633839</td>
      <td>7.79159</td>
      <td>8.474601</td>
      <td>19.245033</td>
      <td>8.164537</td>
      <td>49.960477</td>
      <td>151.039033</td>
      <td>181.144454</td>
    </tr>
    <tr>
      <th>min</th>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>0.82000</td>
      <td>0.760000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>13.94000</td>
      <td>16.665000</td>
      <td>47.000000</td>
      <td>7.001500</td>
      <td>4.000000</td>
      <td>36.000000</td>
      <td>42.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>3.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>20.50000</td>
      <td>24.240000</td>
      <td>62.000000</td>
      <td>12.998000</td>
      <td>17.000000</td>
      <td>118.000000</td>
      <td>145.000000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>4.000000</td>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>2.000000</td>
      <td>26.24000</td>
      <td>31.060000</td>
      <td>77.000000</td>
      <td>16.997900</td>
      <td>49.000000</td>
      <td>222.000000</td>
      <td>284.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>4.000000</td>
      <td>41.00000</td>
      <td>45.455000</td>
      <td>100.000000</td>
      <td>56.996900</td>
      <td>367.000000</td>
      <td>886.000000</td>
      <td>977.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="5">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>train.info()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 10886 entries, 0 to 10885
Data columns (total 12 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   datetime    10886 non-null  object 
 1   season      10886 non-null  int64  
 2   holiday     10886 non-null  int64  
 3   workingday  10886 non-null  int64  
 4   weather     10886 non-null  int64  
 5   temp        10886 non-null  float64
 6   atemp       10886 non-null  float64
 7   humidity    10886 non-null  int64  
 8   windspeed   10886 non-null  float64
 9   casual      10886 non-null  int64  
 10  registered  10886 non-null  int64  
 11  count       10886 non-null  int64  
dtypes: float64(3), int64(8), object(1)
memory usage: 1020.7+ KB
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="6"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="vkEn_m-N0NC2" data-outputId="a88fdf22-1961-4bab-c614-1226c32fdcbf">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the test pandas dataframe in pandas by reading the csv, remember to parse the datetime!</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>test <span class="op">=</span> pd.read_csv(<span class="st">&#39;test.csv&#39;</span>, parse_dates<span class="op">=</span>[<span class="st">&#39;datetime&#39;</span>])</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>test.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="6">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>11.365</td>
      <td>56</td>
      <td>26.0027</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="8"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="xPg3KnDe0NC3" data-outputId="0b4246fc-f205-4ae7-ee41-8c3c0d15338c">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same thing as train and test dataset</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>submission <span class="op">=</span> pd.read_csv(<span class="st">&#39;sampleSubmission.csv&#39;</span>, parse_dates<span class="op">=</span>[<span class="st">&#39;datetime&#39;</span>])</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>submission.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="8">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="step-3-train-a-model-using-autogluons-tabular-prediction"
class="cell markdown" id="JeAFILhJ0NC3">
<h2>Step 3: Train a model using AutoGluon’s Tabular Prediction</h2>
</section>
<div class="cell markdown" id="NsLJQNT80NC4">
<p>Requirements:</p>
<ul>
<li>We are prediting <code>count</code>, so it is the label we are
setting.</li>
<li>Ignore <code>casual</code> and <code>registered</code> columns as
they are also not present in the test dataset.</li>
<li>Use the <code>root_mean_squared_error</code> as the metric to use
for evaluation.</li>
<li>Set a time limit of 10 minutes (600 seconds).</li>
<li>Use the preset <code>best_quality</code> to focus on creating the
best model.</li>
</ul>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="6xnZkBFh0NC4" data-outputId="455495d0-5c00-44df-9acc-cfeaffc0990a">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>predictor <span class="op">=</span> TabularPredictor(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">&quot;count&quot;</span>, problem_type<span class="op">=</span><span class="st">&quot;regression&quot;</span>, eval_metric<span class="op">=</span><span class="st">&quot;rmse&quot;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    ).fit(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train.drop([<span class="st">&#39;casual&#39;</span>, <span class="st">&#39;registered&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    time_limit<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    presets<span class="op">=</span><span class="st">&#39;best_quality&#39;</span>)</span></code></pre></div>
</div>
<section
id="review-autogluons-training-run-with-ranking-of-models-that-did-the-best"
class="cell markdown" id="re29BriH0NC5">
<h3>Review AutoGluon's training run with ranking of models that did the
best.</h3>
</section>
<div class="cell code" data-execution_count="10"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="j7oDf2_40NC5" data-outputId="34163c6e-65ab-4302-f496-ed8640b9cdf5">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>predictor.fit_summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>*** Summary of fit() ***
Estimated performance of each model:
                     model   score_val              eval_metric  pred_time_val    fit_time  pred_time_val_marginal  fit_time_marginal  stack_level  can_infer  fit_order
0      WeightedEnsemble_L3  -53.116753  root_mean_squared_error      21.155264  362.082997                0.000000           0.049943            3       True         13
1   RandomForestMSE_BAG_L2  -53.510764  root_mean_squared_error      20.722668  345.549226                0.561211          67.850896            2       True         12
2          LightGBM_BAG_L2  -54.890519  root_mean_squared_error      20.594053  294.182159                0.432596          16.483829            2       True         11
3        LightGBMXT_BAG_L2  -60.714153  root_mean_squared_error      28.467947  314.032578                8.306490          36.334248            2       True         10
4      WeightedEnsemble_L2  -84.146423  root_mean_squared_error       0.034001    0.156033                0.000000           0.048517            2       True          9
5    KNeighborsDist_BAG_L1  -84.146423  root_mean_squared_error       0.034001    0.107516                0.034001           0.107516            1       True          2
6    KNeighborsUnif_BAG_L1 -101.588176  root_mean_squared_error       0.039268    0.084233                0.039268           0.084233            1       True          1
7   RandomForestMSE_BAG_L1 -116.552091  root_mean_squared_error       0.471215   20.323657                0.471215          20.323657            1       True          5
8     ExtraTreesMSE_BAG_L1 -124.602302  root_mean_squared_error       0.455194   10.600101                0.455194          10.600101            1       True          7
9          CatBoost_BAG_L1 -130.566910  root_mean_squared_error       0.190889  138.647323                0.190889         138.647323            1       True          6
10         LightGBM_BAG_L1 -131.054162  root_mean_squared_error       2.128777   19.967262                2.128777          19.967262            1       True          4
11       LightGBMXT_BAG_L1 -131.460909  root_mean_squared_error      16.399037   55.415169               16.399037          55.415169            1       True          3
12  NeuralNetFastAI_BAG_L1 -144.457646  root_mean_squared_error       0.443076   32.553071                0.443076          32.553071            1       True          8
Number of models trained: 13
Types of models trained:
{&#39;StackerEnsembleModel_RF&#39;, &#39;StackerEnsembleModel_LGB&#39;, &#39;StackerEnsembleModel_CatBoost&#39;, &#39;WeightedEnsembleModel&#39;, &#39;StackerEnsembleModel_KNN&#39;, &#39;StackerEnsembleModel_XT&#39;, &#39;StackerEnsembleModel_NNFastAiTabular&#39;}
Bagging used: True  (with 8 folds)
Multi-layer stack-ensembling used: True  (with 3 levels)
Feature Metadata (Processed):
(raw dtype, special dtypes):
(&#39;float&#39;, [])                : 3 | [&#39;temp&#39;, &#39;atemp&#39;, &#39;windspeed&#39;]
(&#39;int&#39;, [])                  : 3 | [&#39;season&#39;, &#39;weather&#39;, &#39;humidity&#39;]
(&#39;int&#39;, [&#39;bool&#39;])            : 2 | [&#39;holiday&#39;, &#39;workingday&#39;]
(&#39;int&#39;, [&#39;datetime_as_int&#39;]) : 5 | [&#39;datetime&#39;, &#39;datetime.year&#39;, &#39;datetime.month&#39;, &#39;datetime.day&#39;, &#39;datetime.dayofweek&#39;]
*** End of fit() summary ***
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>c:\Users\DELL\AppData\Local\Programs\Python\Python311\Lib\site-packages\autogluon\core\utils\plots.py:169: UserWarning: AutoGluon summary plots cannot be created because bokeh is not installed. To see plots, please do: &quot;pip install bokeh==2.0.1&quot;
  warnings.warn(&#39;AutoGluon summary plots cannot be created because bokeh is not installed. To see plots, please do: &quot;pip install bokeh==2.0.1&quot;&#39;)
</code></pre>
</div>
<div class="output execute_result" data-execution_count="10">
<pre><code>{&#39;model_types&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: &#39;StackerEnsembleModel_KNN&#39;,
  &#39;KNeighborsDist_BAG_L1&#39;: &#39;StackerEnsembleModel_KNN&#39;,
  &#39;LightGBMXT_BAG_L1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;RandomForestMSE_BAG_L1&#39;: &#39;StackerEnsembleModel_RF&#39;,
  &#39;CatBoost_BAG_L1&#39;: &#39;StackerEnsembleModel_CatBoost&#39;,
  &#39;ExtraTreesMSE_BAG_L1&#39;: &#39;StackerEnsembleModel_XT&#39;,
  &#39;NeuralNetFastAI_BAG_L1&#39;: &#39;StackerEnsembleModel_NNFastAiTabular&#39;,
  &#39;WeightedEnsemble_L2&#39;: &#39;WeightedEnsembleModel&#39;,
  &#39;LightGBMXT_BAG_L2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;RandomForestMSE_BAG_L2&#39;: &#39;StackerEnsembleModel_RF&#39;,
  &#39;WeightedEnsemble_L3&#39;: &#39;WeightedEnsembleModel&#39;},
 &#39;model_performance&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: -101.58817625927213,
  &#39;KNeighborsDist_BAG_L1&#39;: -84.14642264302962,
  &#39;LightGBMXT_BAG_L1&#39;: -131.46090891834504,
  &#39;LightGBM_BAG_L1&#39;: -131.054161598899,
  &#39;RandomForestMSE_BAG_L1&#39;: -116.55209143577434,
  &#39;CatBoost_BAG_L1&#39;: -130.56690985866868,
  &#39;ExtraTreesMSE_BAG_L1&#39;: -124.60230209225125,
  &#39;NeuralNetFastAI_BAG_L1&#39;: -144.45764646707613,
  &#39;WeightedEnsemble_L2&#39;: -84.14642264302962,
  &#39;LightGBMXT_BAG_L2&#39;: -60.714153262637865,
  &#39;LightGBM_BAG_L2&#39;: -54.89051889584528,
  &#39;RandomForestMSE_BAG_L2&#39;: -53.51076394970929,
  &#39;WeightedEnsemble_L3&#39;: -53.116753172237416},
 &#39;model_best&#39;: &#39;WeightedEnsemble_L3&#39;,
 &#39;model_paths&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: [&#39;KNeighborsUnif_BAG_L1&#39;],
  &#39;KNeighborsDist_BAG_L1&#39;: [&#39;KNeighborsDist_BAG_L1&#39;],
  &#39;LightGBMXT_BAG_L1&#39;: [&#39;LightGBMXT_BAG_L1&#39;],
  &#39;LightGBM_BAG_L1&#39;: [&#39;LightGBM_BAG_L1&#39;],
  &#39;RandomForestMSE_BAG_L1&#39;: [&#39;RandomForestMSE_BAG_L1&#39;],
  &#39;CatBoost_BAG_L1&#39;: [&#39;CatBoost_BAG_L1&#39;],
  &#39;ExtraTreesMSE_BAG_L1&#39;: [&#39;ExtraTreesMSE_BAG_L1&#39;],
  &#39;NeuralNetFastAI_BAG_L1&#39;: [&#39;NeuralNetFastAI_BAG_L1&#39;],
  &#39;WeightedEnsemble_L2&#39;: [&#39;WeightedEnsemble_L2&#39;],
  &#39;LightGBMXT_BAG_L2&#39;: [&#39;LightGBMXT_BAG_L2&#39;],
  &#39;LightGBM_BAG_L2&#39;: [&#39;LightGBM_BAG_L2&#39;],
  &#39;RandomForestMSE_BAG_L2&#39;: [&#39;RandomForestMSE_BAG_L2&#39;],
  &#39;WeightedEnsemble_L3&#39;: [&#39;WeightedEnsemble_L3&#39;]},
 &#39;model_fit_times&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: 0.08423280715942383,
  &#39;KNeighborsDist_BAG_L1&#39;: 0.10751581192016602,
  &#39;LightGBMXT_BAG_L1&#39;: 55.41516852378845,
  &#39;LightGBM_BAG_L1&#39;: 19.96726155281067,
  &#39;RandomForestMSE_BAG_L1&#39;: 20.323656797409058,
  &#39;CatBoost_BAG_L1&#39;: 138.64732265472412,
  &#39;ExtraTreesMSE_BAG_L1&#39;: 10.600100755691528,
  &#39;NeuralNetFastAI_BAG_L1&#39;: 32.55307102203369,
  &#39;WeightedEnsemble_L2&#39;: 0.048517465591430664,
  &#39;LightGBMXT_BAG_L2&#39;: 36.33424758911133,
  &#39;LightGBM_BAG_L2&#39;: 16.48382878303528,
  &#39;RandomForestMSE_BAG_L2&#39;: 67.85089588165283,
  &#39;WeightedEnsemble_L3&#39;: 0.049942731857299805},
 &#39;model_pred_times&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: 0.03926801681518555,
  &#39;KNeighborsDist_BAG_L1&#39;: 0.03400111198425293,
  &#39;LightGBMXT_BAG_L1&#39;: 16.399036645889282,
  &#39;LightGBM_BAG_L1&#39;: 2.128777265548706,
  &#39;RandomForestMSE_BAG_L1&#39;: 0.47121548652648926,
  &#39;CatBoost_BAG_L1&#39;: 0.1908891201019287,
  &#39;ExtraTreesMSE_BAG_L1&#39;: 0.45519351959228516,
  &#39;NeuralNetFastAI_BAG_L1&#39;: 0.44307589530944824,
  &#39;WeightedEnsemble_L2&#39;: 0.0,
  &#39;LightGBMXT_BAG_L2&#39;: 8.306490182876587,
  &#39;LightGBM_BAG_L2&#39;: 0.43259572982788086,
  &#39;RandomForestMSE_BAG_L2&#39;: 0.561211109161377,
  &#39;WeightedEnsemble_L3&#39;: 0.0},
 &#39;num_bag_folds&#39;: 8,
 &#39;max_stack_level&#39;: 3,
 &#39;model_hyperparams&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;KNeighborsDist_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;LightGBMXT_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBM_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;RandomForestMSE_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;CatBoost_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;ExtraTreesMSE_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;NeuralNetFastAI_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;WeightedEnsemble_L2&#39;: {&#39;use_orig_features&#39;: False,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBMXT_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBM_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;RandomForestMSE_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;WeightedEnsemble_L3&#39;: {&#39;use_orig_features&#39;: False,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True}},
 &#39;leaderboard&#39;:                      model   score_val              eval_metric  \
 0      WeightedEnsemble_L3  -53.116753  root_mean_squared_error   
 1   RandomForestMSE_BAG_L2  -53.510764  root_mean_squared_error   
 2          LightGBM_BAG_L2  -54.890519  root_mean_squared_error   
 3        LightGBMXT_BAG_L2  -60.714153  root_mean_squared_error   
 4      WeightedEnsemble_L2  -84.146423  root_mean_squared_error   
 5    KNeighborsDist_BAG_L1  -84.146423  root_mean_squared_error   
 6    KNeighborsUnif_BAG_L1 -101.588176  root_mean_squared_error   
 7   RandomForestMSE_BAG_L1 -116.552091  root_mean_squared_error   
 8     ExtraTreesMSE_BAG_L1 -124.602302  root_mean_squared_error   
 9          CatBoost_BAG_L1 -130.566910  root_mean_squared_error   
 10         LightGBM_BAG_L1 -131.054162  root_mean_squared_error   
 11       LightGBMXT_BAG_L1 -131.460909  root_mean_squared_error   
 12  NeuralNetFastAI_BAG_L1 -144.457646  root_mean_squared_error   
 
     pred_time_val    fit_time  pred_time_val_marginal  fit_time_marginal  \
 0       21.155264  362.082997                0.000000           0.049943   
 1       20.722668  345.549226                0.561211          67.850896   
 2       20.594053  294.182159                0.432596          16.483829   
 3       28.467947  314.032578                8.306490          36.334248   
 4        0.034001    0.156033                0.000000           0.048517   
 5        0.034001    0.107516                0.034001           0.107516   
 6        0.039268    0.084233                0.039268           0.084233   
 7        0.471215   20.323657                0.471215          20.323657   
 8        0.455194   10.600101                0.455194          10.600101   
 9        0.190889  138.647323                0.190889         138.647323   
 10       2.128777   19.967262                2.128777          19.967262   
 11      16.399037   55.415169               16.399037          55.415169   
 12       0.443076   32.553071                0.443076          32.553071   
 
     stack_level  can_infer  fit_order  
 0             3       True         13  
 1             2       True         12  
 2             2       True         11  
 3             2       True         10  
 4             2       True          9  
 5             1       True          2  
 6             1       True          1  
 7             1       True          5  
 8             1       True          7  
 9             1       True          6  
 10            1       True          4  
 11            1       True          3  
 12            1       True          8  }</code></pre>
</div>
</div>
<section id="create-predictions-from-test-dataset" class="cell markdown"
id="9hpjsqpF0NC5">
<h3>Create predictions from test dataset</h3>
</section>
<div class="cell code" data-execution_count="11"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="5V_ozrjx0NC5" data-outputId="5cc58dfe-683d-45d4-bc5c-bfa041f67f8b">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> predictor.predict(test)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> {<span class="st">&#39;datetime&#39;</span>: test[<span class="st">&#39;datetime&#39;</span>], <span class="st">&#39;Pred_count&#39;</span>: predictions}</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>predictions <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>predictions)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>predictions.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="11">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>22.885899</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>42.287304</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>46.484844</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>49.028969</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>51.202511</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section
id="note-kaggle-will-reject-the-submission-if-we-dont-set-everything-to-be--0"
class="cell markdown" id="kCtquLU-0NC6">
<h4>NOTE: Kaggle will reject the submission if we don't set everything
to be &gt; 0.</h4>
</section>
<div class="cell code" data-execution_count="12"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:300}"
id="b0CQ8DxD0NC6" data-outputId="0dfca714-cae0-4ef5-b28b-219cc7970374">
<div class="sourceCode" id="cb20"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Describe the `predictions` series to see if there are any negative values</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>predictions.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="12">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6493</td>
      <td>6493.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2012-01-13 09:27:47.765285632</td>
      <td>100.025482</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011-01-20 00:00:00</td>
      <td>3.235392</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2011-07-22 15:00:00</td>
      <td>19.805637</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2012-01-20 23:00:00</td>
      <td>63.990761</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2012-07-20 17:00:00</td>
      <td>165.455078</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2012-12-31 23:00:00</td>
      <td>367.226410</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>89.181915</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="13"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="R-9l2m5O0NC6" data-outputId="55ea98fb-4d45-44b8-a4c5-b7cddfdefda0">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># How many negative values do we have?</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>neg <span class="op">=</span> predictions.groupby(predictions[<span class="st">&#39;Pred_count&#39;</span>])</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># lambda function</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minus(val):</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>   <span class="cf">return</span> val[val <span class="op">&lt;</span> <span class="dv">0</span>].<span class="bu">sum</span>()</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(neg[<span class="st">&#39;Pred_count&#39;</span>].agg([(<span class="st">&#39;negcount&#39;</span>, minus)]))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>            negcount
Pred_count          
3.235392         0.0
3.408119         0.0
3.544232         0.0
3.560749         0.0
3.566258         0.0
...              ...
364.566315       0.0
364.836029       0.0
366.892120       0.0
366.933533       0.0
367.226410       0.0

[6151 rows x 1 columns]
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="14" id="d5JebCz00NC6">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set them to zero</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>predictions[predictions[<span class="st">&#39;Pred_count&#39;</span>]<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="15"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:300}"
id="aEVDwhpWBrR5" data-outputId="03ecc9fc-1e4c-40e5-a411-1da26b2bcb6e">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>predictions.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="15">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6493</td>
      <td>6493.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2012-01-13 09:27:47.765285632</td>
      <td>100.025482</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011-01-20 00:00:00</td>
      <td>3.235392</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2011-07-22 15:00:00</td>
      <td>19.805637</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2012-01-20 23:00:00</td>
      <td>63.990761</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2012-07-20 17:00:00</td>
      <td>165.455078</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2012-12-31 23:00:00</td>
      <td>367.226410</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>89.181915</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="16"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="BY2lc7PIB6bN" data-outputId="cbeb5a44-50d3-4692-80be-90583ec2c264">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>predictions.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="16">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>22.885899</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>42.287304</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>46.484844</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>49.028969</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>51.202511</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="set-predictions-to-submission-dataframe-save-and-submit"
class="cell markdown" id="pDgllGCX0NC6">
<h3>Set predictions to submission dataframe, save, and submit</h3>
</section>
<div class="cell code" data-execution_count="17" id="gBoGtgWD0NC7">
<div class="sourceCode" id="cb26"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>submission[<span class="st">&quot;count&quot;</span>] <span class="op">=</span> predictions[<span class="st">&#39;Pred_count&#39;</span>]</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>submission.to_csv(<span class="st">&quot;submission.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="18"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="R876UIsy0NC7" data-outputId="757f5cd2-d845-483d-e791-b431debddaac">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submit <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">-</span>f submission.csv <span class="op">-</span>m <span class="st">&quot;first raw submission&quot;</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Successfully submitted to Bike Sharing Demand
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>
  0%|          | 0.00/195k [00:00&lt;?, ?B/s]
  4%|▍         | 8.00k/195k [01:24&lt;32:57, 96.7B/s]
 90%|█████████ | 176k/195k [01:24&lt;00:06, 2.99kB/s]
100%|██████████| 195k/195k [01:26&lt;00:00, 2.32kB/s]
</code></pre>
</div>
</div>
<section
id="view-submission-via-the-command-line-or-in-the-web-browser-under-the-competitions-page---my-submissions"
class="cell markdown" id="ophlA2NZ0NC7">
<h4>View submission via the command line or in the web browser under the
competition's page - <code>My Submissions</code></h4>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="1yLnlQZP0NC7" data-outputId="966be150-5970-4415-974a-41e63dcdb480">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submissions <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">|</span> tail <span class="op">-</span>n <span class="op">+</span><span class="dv">1</span> <span class="op">|</span> head <span class="op">-</span>n <span class="dv">6</span></span></code></pre></div>
</div>
<section id="initial-score-of-139920" class="cell markdown"
id="QVMCAyed0NC8">
<h4>Initial score of 1.39920</h4>
</section>
<section
id="step-4-exploratory-data-analysis-and-creating-an-additional-feature"
class="cell markdown" id="ahqid-L-0NC8">
<h2>Step 4: Exploratory Data Analysis and Creating an additional
feature</h2>
<ul>
<li>Any additional feature will do, but a great suggestion would be to
separate out the datetime into hour, day, or month parts.</li>
</ul>
</section>
<div class="cell code" data-execution_count="19"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:507}"
id="F0lRgody0NC8" data-outputId="5b064292-7c09-4f75-b995-2b2c495b45bb">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of all features to show the distribution of each one relative to the data. This is part of the exploritory data analysis</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>train.hist()</span></code></pre></div>
<div class="output execute_result" data-execution_count="19">
<pre><code>array([[&lt;Axes: title={&#39;center&#39;: &#39;season&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;holiday&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;workingday&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;weather&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;temp&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;atemp&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;humidity&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;windspeed&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;casual&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;registered&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;count&#39;}&gt;, &lt;Axes: &gt;]], dtype=object)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/775dcbf5de318f91f2dd66522d59c164e38dbcb6.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="22" id="xcVnVACp0NC8">
<div class="sourceCode" id="cb33"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a new feature</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>train <span class="op">=</span> pd.read_csv(<span class="st">&#39;train.csv&#39;</span>, parse_dates<span class="op">=</span>[<span class="st">&#39;datetime&#39;</span>])</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>train.loc[:, <span class="st">&quot;datetime&quot;</span>] <span class="op">=</span> pd.to_datetime(train.loc[:, <span class="st">&quot;datetime&quot;</span>])</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>test.loc[:, <span class="st">&quot;datetime&quot;</span>] <span class="op">=</span> pd.to_datetime(test.loc[:, <span class="st">&quot;datetime&quot;</span>])</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> train[<span class="st">&#39;datetime&#39;</span>].dt.year</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&#39;month&#39;</span>] <span class="op">=</span> train[<span class="st">&#39;datetime&#39;</span>].dt.month</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&#39;day&#39;</span>] <span class="op">=</span> train[<span class="st">&#39;datetime&#39;</span>].dt.day</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&#39;hour&#39;</span>] <span class="op">=</span> train[<span class="st">&#39;datetime&#39;</span>].dt.hour</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> test[<span class="st">&#39;datetime&#39;</span>].dt.year</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&#39;month&#39;</span>] <span class="op">=</span> test[<span class="st">&#39;datetime&#39;</span>].dt.month</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&#39;day&#39;</span>] <span class="op">=</span> test[<span class="st">&#39;datetime&#39;</span>].dt.day</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&#39;hour&#39;</span>] <span class="op">=</span> test[<span class="st">&#39;datetime&#39;</span>].dt.hour</span></code></pre></div>
</div>
<section
id="make-category-types-for-these-so-models-know-they-are-not-just-numbers"
class="cell markdown" id="qRYDV7zj0NC8">
<h2>Make category types for these so models know they are not just
numbers</h2>
<ul>
<li>AutoGluon originally sees these as ints, but in reality they are int
representations of a category.</li>
<li>Setting the dtype to category will classify these as categories in
AutoGluon.</li>
</ul>
</section>
<div class="cell code" data-execution_count="23" id="EJ3dWN1e0NC9">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&quot;season&quot;</span>] <span class="op">=</span> train[<span class="st">&quot;season&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>train[<span class="st">&quot;weather&quot;</span>] <span class="op">=</span> train[<span class="st">&quot;weather&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&quot;season&quot;</span>] <span class="op">=</span> test[<span class="st">&quot;season&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>test[<span class="st">&quot;weather&quot;</span>] <span class="op">=</span> test[<span class="st">&quot;weather&quot;</span>].astype(<span class="st">&quot;category&quot;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="24"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="5ErytBlh0NC9" data-outputId="dbf428f5-4235-4f61-81be-4be1a5a84350">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View are new feature</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>train.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="24">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-01 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-01 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-01 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-01 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-01 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="25"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:576}"
id="kWZC_yPk0NC9" data-outputId="0b3f9f1f-b1f1-489d-858c-ce93c9d9c26a">
<div class="sourceCode" id="cb36"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View histogram of all features again now with the hour feature</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>train.hist()</span></code></pre></div>
<div class="output execute_result" data-execution_count="25">
<pre><code>array([[&lt;Axes: title={&#39;center&#39;: &#39;datetime&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;holiday&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;workingday&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;temp&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;atemp&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;humidity&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;windspeed&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;casual&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;registered&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;count&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;year&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;month&#39;}&gt;],
       [&lt;Axes: title={&#39;center&#39;: &#39;day&#39;}&gt;,
        &lt;Axes: title={&#39;center&#39;: &#39;hour&#39;}&gt;, &lt;Axes: &gt;, &lt;Axes: &gt;]],
      dtype=object)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/9a54cc903719eb26372a9b99e94af85072edc2df.png" /></p>
</div>
</div>
<section
id="step-5-rerun-the-model-with-the-same-settings-as-before-just-with-more-features"
class="cell markdown" id="V5_8HcLG0NC9">
<h2>Step 5: Rerun the model with the same settings as before, just with
more features</h2>
</section>
<div class="cell code" data-execution_count="26"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="qNqRR5Ak0NC9" data-outputId="867b015a-37da-4425-b4ad-dde639e5d620">
<div class="sourceCode" id="cb38"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>predictor_new_features <span class="op">=</span> TabularPredictor(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">&quot;count&quot;</span>, problem_type<span class="op">=</span><span class="st">&quot;regression&quot;</span>, eval_metric<span class="op">=</span><span class="st">&quot;rmse&quot;</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    ).fit(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train.drop([<span class="st">&#39;casual&#39;</span>, <span class="st">&#39;registered&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    time_limit<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    presets<span class="op">=</span><span class="st">&#39;best_quality&#39;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>	-38.1182	 = Validation score   (-root_mean_squared_error)
	90.8s	 = Training   runtime
	0.42s	 = Validation runtime
Fitting model: ExtraTreesMSE_BAG_L1 ... Training model for up to 7.79s of the 147.51s of remaining time.
	-38.1081	 = Validation score   (-root_mean_squared_error)
	17.83s	 = Training   runtime
	0.86s	 = Validation runtime
Fitting model: WeightedEnsemble_L2 ... Training model for up to 360.0s of the 125.26s of remaining time.
	Ensemble Weights: {&#39;LightGBM_BAG_L1&#39;: 0.4, &#39;LightGBMXT_BAG_L1&#39;: 0.36, &#39;RandomForestMSE_BAG_L1&#39;: 0.12, &#39;KNeighborsDist_BAG_L1&#39;: 0.04, &#39;CatBoost_BAG_L1&#39;: 0.04, &#39;ExtraTreesMSE_BAG_L1&#39;: 0.04}
	-32.4187	 = Validation score   (-root_mean_squared_error)
	0.05s	 = Training   runtime
	0.0s	 = Validation runtime
Fitting 106 L2 models ...
Fitting model: LightGBMXT_BAG_L2 ... Training model for up to 125.14s of the 125.1s of remaining time.
	Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (4 workers, per: cpus=1, gpus=0, memory=0.65%)
	-30.9556	 = Validation score   (-root_mean_squared_error)
	31.6s	 = Training   runtime
	2.92s	 = Validation runtime
Fitting model: LightGBM_BAG_L2 ... Training model for up to 80.38s of the 80.34s of remaining time.
	Fitting 8 child models (S1F1 - S1F8) | Fitting with ParallelLocalFoldFittingStrategy (4 workers, per: cpus=1, gpus=0, memory=0.70%)
	-30.5998	 = Validation score   (-root_mean_squared_error)
	22.02s	 = Training   runtime
	0.55s	 = Validation runtime
Fitting model: RandomForestMSE_BAG_L2 ... Training model for up to 49.34s of the 49.31s of remaining time.
	-31.7856	 = Validation score   (-root_mean_squared_error)
	83.39s	 = Training   runtime
	0.68s	 = Validation runtime
Fitting model: WeightedEnsemble_L3 ... Training model for up to 360.0s of the -36.5s of remaining time.
	Ensemble Weights: {&#39;LightGBM_BAG_L2&#39;: 0.52, &#39;LightGBMXT_BAG_L2&#39;: 0.36, &#39;RandomForestMSE_BAG_L2&#39;: 0.08, &#39;CatBoost_BAG_L1&#39;: 0.04}
	-30.3219	 = Validation score   (-root_mean_squared_error)
	0.03s	 = Training   runtime
	0.0s	 = Validation runtime
AutoGluon training complete, total runtime = 456.62s ... Best model: &quot;WeightedEnsemble_L3&quot;
TabularPredictor saved. To load, use: predictor = TabularPredictor.load(&quot;AutogluonModels\ag-20240430_163232&quot;)
</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="27"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="11JzL68-0NC-" data-outputId="f55e07e2-142f-4544-b339-61805e0862e3">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>predictor_new_features.fit_summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>*** Summary of fit() ***
Estimated performance of each model:
                     model   score_val              eval_metric  pred_time_val    fit_time  pred_time_val_marginal  fit_time_marginal  stack_level  can_infer  fit_order
0      WeightedEnsemble_L3  -30.321889  root_mean_squared_error      40.092079  402.656349                0.000000           0.025981            3       True         12
1          LightGBM_BAG_L2  -30.599795  root_mean_squared_error      36.494398  287.641776                0.546884          22.021480            2       True         10
2        LightGBMXT_BAG_L2  -30.955635  root_mean_squared_error      38.864244  297.219949                2.916730          31.599653            2       True          9
3   RandomForestMSE_BAG_L2  -31.785639  root_mean_squared_error      36.628466  349.009234                0.680951          83.388939            2       True         11
4      WeightedEnsemble_L2  -32.418706  root_mean_squared_error      35.892728  265.540072                0.001003           0.051450            2       True          8
5          LightGBM_BAG_L1  -33.917339  root_mean_squared_error       6.470384   31.692827                6.470384          31.692827            1       True          4
6        LightGBMXT_BAG_L1  -34.453884  root_mean_squared_error      27.458816   76.443241               27.458816          76.443241            1       True          3
7     ExtraTreesMSE_BAG_L1  -38.108108  root_mean_squared_error       0.859439   17.833260                0.859439          17.833260            1       True          7
8          CatBoost_BAG_L1  -38.118217  root_mean_squared_error       0.418277   90.798016                0.418277          90.798016            1       True          6
9   RandomForestMSE_BAG_L1  -38.425642  root_mean_squared_error       0.652501   48.650003                0.652501          48.650003            1       True          5
10   KNeighborsDist_BAG_L1  -84.146423  root_mean_squared_error       0.032309    0.071275                0.032309           0.071275            1       True          2
11   KNeighborsUnif_BAG_L1 -101.588176  root_mean_squared_error       0.055789    0.131674                0.055789           0.131674            1       True          1
Number of models trained: 12
Types of models trained:
{&#39;StackerEnsembleModel_RF&#39;, &#39;StackerEnsembleModel_LGB&#39;, &#39;StackerEnsembleModel_CatBoost&#39;, &#39;WeightedEnsembleModel&#39;, &#39;StackerEnsembleModel_KNN&#39;, &#39;StackerEnsembleModel_XT&#39;}
Bagging used: True  (with 8 folds)
Multi-layer stack-ensembling used: True  (with 3 levels)
Feature Metadata (Processed):
(raw dtype, special dtypes):
(&#39;category&#39;, [])             : 2 | [&#39;season&#39;, &#39;weather&#39;]
(&#39;float&#39;, [])                : 3 | [&#39;temp&#39;, &#39;atemp&#39;, &#39;windspeed&#39;]
(&#39;int&#39;, [])                  : 4 | [&#39;humidity&#39;, &#39;month&#39;, &#39;day&#39;, &#39;hour&#39;]
(&#39;int&#39;, [&#39;bool&#39;])            : 3 | [&#39;holiday&#39;, &#39;workingday&#39;, &#39;year&#39;]
(&#39;int&#39;, [&#39;datetime_as_int&#39;]) : 3 | [&#39;datetime&#39;, &#39;datetime.year&#39;, &#39;datetime.dayofweek&#39;]
*** End of fit() summary ***
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>c:\Users\DELL\AppData\Local\Programs\Python\Python311\Lib\site-packages\autogluon\core\utils\plots.py:169: UserWarning: AutoGluon summary plots cannot be created because bokeh is not installed. To see plots, please do: &quot;pip install bokeh==2.0.1&quot;
  warnings.warn(&#39;AutoGluon summary plots cannot be created because bokeh is not installed. To see plots, please do: &quot;pip install bokeh==2.0.1&quot;&#39;)
</code></pre>
</div>
<div class="output execute_result" data-execution_count="27">
<pre><code>{&#39;model_types&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: &#39;StackerEnsembleModel_KNN&#39;,
  &#39;KNeighborsDist_BAG_L1&#39;: &#39;StackerEnsembleModel_KNN&#39;,
  &#39;LightGBMXT_BAG_L1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;RandomForestMSE_BAG_L1&#39;: &#39;StackerEnsembleModel_RF&#39;,
  &#39;CatBoost_BAG_L1&#39;: &#39;StackerEnsembleModel_CatBoost&#39;,
  &#39;ExtraTreesMSE_BAG_L1&#39;: &#39;StackerEnsembleModel_XT&#39;,
  &#39;WeightedEnsemble_L2&#39;: &#39;WeightedEnsembleModel&#39;,
  &#39;LightGBMXT_BAG_L2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;RandomForestMSE_BAG_L2&#39;: &#39;StackerEnsembleModel_RF&#39;,
  &#39;WeightedEnsemble_L3&#39;: &#39;WeightedEnsembleModel&#39;},
 &#39;model_performance&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: -101.58817625927213,
  &#39;KNeighborsDist_BAG_L1&#39;: -84.14642264302962,
  &#39;LightGBMXT_BAG_L1&#39;: -34.453884062670745,
  &#39;LightGBM_BAG_L1&#39;: -33.91733862651761,
  &#39;RandomForestMSE_BAG_L1&#39;: -38.42564244339945,
  &#39;CatBoost_BAG_L1&#39;: -38.1182173288243,
  &#39;ExtraTreesMSE_BAG_L1&#39;: -38.108107585089144,
  &#39;WeightedEnsemble_L2&#39;: -32.418705890141744,
  &#39;LightGBMXT_BAG_L2&#39;: -30.95563456448992,
  &#39;LightGBM_BAG_L2&#39;: -30.599795116436287,
  &#39;RandomForestMSE_BAG_L2&#39;: -31.785639440260667,
  &#39;WeightedEnsemble_L3&#39;: -30.32188860799253},
 &#39;model_best&#39;: &#39;WeightedEnsemble_L3&#39;,
 &#39;model_paths&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: [&#39;KNeighborsUnif_BAG_L1&#39;],
  &#39;KNeighborsDist_BAG_L1&#39;: [&#39;KNeighborsDist_BAG_L1&#39;],
  &#39;LightGBMXT_BAG_L1&#39;: [&#39;LightGBMXT_BAG_L1&#39;],
  &#39;LightGBM_BAG_L1&#39;: [&#39;LightGBM_BAG_L1&#39;],
  &#39;RandomForestMSE_BAG_L1&#39;: [&#39;RandomForestMSE_BAG_L1&#39;],
  &#39;CatBoost_BAG_L1&#39;: [&#39;CatBoost_BAG_L1&#39;],
  &#39;ExtraTreesMSE_BAG_L1&#39;: [&#39;ExtraTreesMSE_BAG_L1&#39;],
  &#39;WeightedEnsemble_L2&#39;: [&#39;WeightedEnsemble_L2&#39;],
  &#39;LightGBMXT_BAG_L2&#39;: [&#39;LightGBMXT_BAG_L2&#39;],
  &#39;LightGBM_BAG_L2&#39;: [&#39;LightGBM_BAG_L2&#39;],
  &#39;RandomForestMSE_BAG_L2&#39;: [&#39;RandomForestMSE_BAG_L2&#39;],
  &#39;WeightedEnsemble_L3&#39;: [&#39;WeightedEnsemble_L3&#39;]},
 &#39;model_fit_times&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: 0.13167405128479004,
  &#39;KNeighborsDist_BAG_L1&#39;: 0.07127523422241211,
  &#39;LightGBMXT_BAG_L1&#39;: 76.44324111938477,
  &#39;LightGBM_BAG_L1&#39;: 31.692826509475708,
  &#39;RandomForestMSE_BAG_L1&#39;: 48.6500027179718,
  &#39;CatBoost_BAG_L1&#39;: 90.79801559448242,
  &#39;ExtraTreesMSE_BAG_L1&#39;: 17.83326029777527,
  &#39;WeightedEnsemble_L2&#39;: 0.051450490951538086,
  &#39;LightGBMXT_BAG_L2&#39;: 31.599653482437134,
  &#39;LightGBM_BAG_L2&#39;: 22.021480083465576,
  &#39;RandomForestMSE_BAG_L2&#39;: 83.3889389038086,
  &#39;WeightedEnsemble_L3&#39;: 0.025981426239013672},
 &#39;model_pred_times&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: 0.05578875541687012,
  &#39;KNeighborsDist_BAG_L1&#39;: 0.03230881690979004,
  &#39;LightGBMXT_BAG_L1&#39;: 27.458815574645996,
  &#39;LightGBM_BAG_L1&#39;: 6.470383882522583,
  &#39;RandomForestMSE_BAG_L1&#39;: 0.652501106262207,
  &#39;CatBoost_BAG_L1&#39;: 0.4182772636413574,
  &#39;ExtraTreesMSE_BAG_L1&#39;: 0.8594391345977783,
  &#39;WeightedEnsemble_L2&#39;: 0.0010025501251220703,
  &#39;LightGBMXT_BAG_L2&#39;: 2.916729688644409,
  &#39;LightGBM_BAG_L2&#39;: 0.5468838214874268,
  &#39;RandomForestMSE_BAG_L2&#39;: 0.6809513568878174,
  &#39;WeightedEnsemble_L3&#39;: 0.0},
 &#39;num_bag_folds&#39;: 8,
 &#39;max_stack_level&#39;: 3,
 &#39;model_hyperparams&#39;: {&#39;KNeighborsUnif_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;KNeighborsDist_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;LightGBMXT_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBM_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;RandomForestMSE_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;CatBoost_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;ExtraTreesMSE_BAG_L1&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;WeightedEnsemble_L2&#39;: {&#39;use_orig_features&#39;: False,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBMXT_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;LightGBM_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True},
  &#39;RandomForestMSE_BAG_L2&#39;: {&#39;use_orig_features&#39;: True,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_child_oof&#39;: True},
  &#39;WeightedEnsemble_L3&#39;: {&#39;use_orig_features&#39;: False,
   &#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True}},
 &#39;leaderboard&#39;:                      model   score_val              eval_metric  \
 0      WeightedEnsemble_L3  -30.321889  root_mean_squared_error   
 1          LightGBM_BAG_L2  -30.599795  root_mean_squared_error   
 2        LightGBMXT_BAG_L2  -30.955635  root_mean_squared_error   
 3   RandomForestMSE_BAG_L2  -31.785639  root_mean_squared_error   
 4      WeightedEnsemble_L2  -32.418706  root_mean_squared_error   
 5          LightGBM_BAG_L1  -33.917339  root_mean_squared_error   
 6        LightGBMXT_BAG_L1  -34.453884  root_mean_squared_error   
 7     ExtraTreesMSE_BAG_L1  -38.108108  root_mean_squared_error   
 8          CatBoost_BAG_L1  -38.118217  root_mean_squared_error   
 9   RandomForestMSE_BAG_L1  -38.425642  root_mean_squared_error   
 10   KNeighborsDist_BAG_L1  -84.146423  root_mean_squared_error   
 11   KNeighborsUnif_BAG_L1 -101.588176  root_mean_squared_error   
 
     pred_time_val    fit_time  pred_time_val_marginal  fit_time_marginal  \
 0       40.092079  402.656349                0.000000           0.025981   
 1       36.494398  287.641776                0.546884          22.021480   
 2       38.864244  297.219949                2.916730          31.599653   
 3       36.628466  349.009234                0.680951          83.388939   
 4       35.892728  265.540072                0.001003           0.051450   
 5        6.470384   31.692827                6.470384          31.692827   
 6       27.458816   76.443241               27.458816          76.443241   
 7        0.859439   17.833260                0.859439          17.833260   
 8        0.418277   90.798016                0.418277          90.798016   
 9        0.652501   48.650003                0.652501          48.650003   
 10       0.032309    0.071275                0.032309           0.071275   
 11       0.055789    0.131674                0.055789           0.131674   
 
     stack_level  can_infer  fit_order  
 0             3       True         12  
 1             2       True         10  
 2             2       True          9  
 3             2       True         11  
 4             2       True          8  
 5             1       True          4  
 6             1       True          3  
 7             1       True          7  
 8             1       True          6  
 9             1       True          5  
 10            1       True          2  
 11            1       True          1  }</code></pre>
</div>
</div>
<div class="cell code" data-execution_count="28"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="CA_twuEpLf78" data-outputId="4353c60c-c4f0-4297-b762-84223e3bce29">
<div class="sourceCode" id="cb44"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>predictions_new_features <span class="op">=</span> predictor_new_features.predict(test)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>predictions_new_features <span class="op">=</span> {<span class="st">&#39;datetime&#39;</span>: test[<span class="st">&#39;datetime&#39;</span>], <span class="st">&#39;Pred_count&#39;</span>: predictions_new_features}</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>predictions_new_features <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>predictions_new_features)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>predictions_new_features.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="28">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>15.548494</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>10.331716</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>8.953756</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>7.965948</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>6.694967</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="29" id="jZdWsUUl0NC-">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to set all negative values to zero</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>predictions_new_features[predictions_new_features[<span class="st">&#39;Pred_count&#39;</span>]<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div class="cell code" data-execution_count="30"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:300}"
id="d-gbaIY6MRMC" data-outputId="602d2451-dcd7-4e1a-b0a9-10cf53201654">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>predictions_new_features.describe()</span></code></pre></div>
<div class="output execute_result" data-execution_count="30">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>Pred_count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>6493</td>
      <td>6493.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>2012-01-13 09:27:47.765285632</td>
      <td>163.198853</td>
    </tr>
    <tr>
      <th>min</th>
      <td>2011-01-20 00:00:00</td>
      <td>2.124089</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>2011-07-22 15:00:00</td>
      <td>49.309345</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>2012-01-20 23:00:00</td>
      <td>126.454758</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>2012-07-20 17:00:00</td>
      <td>230.766891</td>
    </tr>
    <tr>
      <th>max</th>
      <td>2012-12-31 23:00:00</td>
      <td>809.200806</td>
    </tr>
    <tr>
      <th>std</th>
      <td>NaN</td>
      <td>145.055237</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="32" id="OzFO6TLb0NC-">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same submitting predictions</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>submission_new_features <span class="op">=</span> pd.read_csv(<span class="st">&#39;submission.csv&#39;</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>submission_new_features[<span class="st">&quot;count&quot;</span>] <span class="op">=</span> predictions_new_features[<span class="st">&#39;Pred_count&#39;</span>]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>submission_new_features.to_csv(<span class="st">&quot;submission_new_features.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="33"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="JVBS_p5j0NC-" data-outputId="3abfff76-52b6-4067-fb0d-fd7b48744181">
<div class="sourceCode" id="cb48"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submit <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">-</span>f submission_new_features.csv <span class="op">-</span>m <span class="st">&quot;new features&quot;</span></span></code></pre></div>
<div class="output stream stdout">
<pre><code>Successfully submitted to Bike Sharing Demand
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>
  0%|          | 0.00/195k [00:00&lt;?, ?B/s]
  4%|▍         | 8.00k/195k [01:24&lt;32:55, 96.7B/s]
 53%|█████▎    | 104k/195k [01:24&lt;00:52, 1.75kB/s]
100%|██████████| 195k/195k [01:26&lt;00:00, 2.31kB/s]
</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="PTGKbxdH0NC-" data-outputId="d27c8b93-613d-4cc1-b0bf-839ab419e122">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submissions <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">|</span> tail <span class="op">-</span>n <span class="op">+</span><span class="dv">1</span> <span class="op">|</span> head <span class="op">-</span>n <span class="dv">6</span></span></code></pre></div>
</div>
<section id="new-score-of-047165" class="cell markdown"
id="atQiWe5r0NC_">
<h4>New Score of <code>0.47165</code></h4>
</section>
<section id="step-6-hyper-parameter-optimization" class="cell markdown"
id="L203m4AT0NC_">
<h2>Step 6: Hyper parameter optimization</h2>
<ul>
<li>There are many options for hyper parameter optimization.</li>
<li>Options are to change the AutoGluon higher level parameters or the
individual model hyperparameters.</li>
<li>The hyperparameters of the models themselves that are in AutoGluon.
Those need the <code>hyperparameter</code> and
<code>hyperparameter_tune_kwargs</code> arguments.</li>
</ul>
</section>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:1000,&quot;referenced_widgets&quot;:[&quot;8f9011c22a1c4173ba24999e0068a7b6&quot;,&quot;222158fb64f7416ab920e609ef61f160&quot;,&quot;56bb05f081004e6cba5f47e1d20f977e&quot;,&quot;bba867a3964743d2b6d4bf6bef848f23&quot;,&quot;90f950755afc4e78b8000afc58ff829c&quot;,&quot;6b9c12e15f674cd59b1150fb6d3eafa1&quot;,&quot;631bae71132c4f74a88ebcdb2567f6ee&quot;,&quot;abdf0090b6e3413ca5da56096c9c5c52&quot;,&quot;92b79c6f62984188be19f35422c38ac9&quot;,&quot;2628afc0066c45d5b68b36c064910641&quot;,&quot;2ba3b4a9175445b69fe549bc2441be53&quot;,&quot;2cc1006751a748d58c2b196f0276b022&quot;,&quot;cc49eee2c91e4ba6bb5a6b446de29efb&quot;,&quot;e30ca7fab66c4290adde0e8cc75647cb&quot;,&quot;ffcf481755044b12827f34e8e23ffcab&quot;,&quot;57c5efa3ae32460a85cb16d76de71021&quot;,&quot;f695757ea9f842d19dd10d8d37ae119b&quot;,&quot;cd62d2fc38764a3d9fccdb898426f496&quot;,&quot;ef31d6f57378464aa303b1e1cca507f5&quot;,&quot;7bd7513ed0a34b7dad1b92e38932482d&quot;,&quot;f808550d34ef4b118b18cf3d354fe435&quot;,&quot;296d65f741604f5e9ca4c5f1f74a3243&quot;,&quot;1abddccf0743403782b84eafc372222a&quot;,&quot;bfabe042b6c84241a87745214ba28011&quot;,&quot;d76f8000914f45b4910d0288fc205d20&quot;,&quot;29c10d79889447dbbb2160d8d952ae1a&quot;,&quot;e927191d9d094e80bd88187f8501d27a&quot;,&quot;0fbb492a3210440187dda3172ea8b419&quot;,&quot;eac85163459d4dc19b61ce50775c2f34&quot;,&quot;be596815eefe46c9bfac65bb026116fe&quot;,&quot;1744b42665e14739860096e3373e048c&quot;,&quot;8f08bd1e59514580805f8ed132018cca&quot;,&quot;18bbc9aba05d45d787167f67009146b8&quot;,&quot;07b4b3f58cfb404cbf7c83b82ad863bc&quot;,&quot;d066b5678a4c487da875a1006a26b4a5&quot;,&quot;067dd1eed9474471839ed38916ce7214&quot;,&quot;5a571b4da70c4f47a5ce045ccbc6908d&quot;,&quot;b46db8e0307a4f7e9ac09b514b5b3fdd&quot;,&quot;66549a98aaca4e50be58fec6650fb546&quot;,&quot;e9aa796ac1624a6ab03a2a9c1c2ceabd&quot;,&quot;1bc2db521e844484a7bf6f559fdb1780&quot;,&quot;94910f0ec5ed4f11a09df0905b7b0e2a&quot;,&quot;46fe14d5ea334c8593b06bac8dd5f63a&quot;,&quot;89b28b25813a4c04bce3b1190907afd6&quot;]}"
id="evsLcbPT0NC_" data-outputId="a4db8df9-3cf7-44df-b33d-549bb44ecedf">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> autogluon.core <span class="im">as</span> ag</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co">## From autogluon documentation</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>nn_options <span class="op">=</span> {  </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;dropout_prob&#39;</span>: ag.space.Real(<span class="fl">0.0</span>, <span class="fl">0.5</span>, default<span class="op">=</span><span class="fl">0.1</span>),  <span class="co"># dropout probability </span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>gbm_options <span class="op">=</span> {  </span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;num_boost_round&#39;</span>: <span class="dv">100</span>,  <span class="co"># number of boosting rounds </span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;num_leaves&#39;</span>: ag.space.Int(lower<span class="op">=</span><span class="dv">26</span>, upper<span class="op">=</span><span class="dv">66</span>, default<span class="op">=</span><span class="dv">36</span>),  <span class="co"># number of leaves in trees</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>hyperparameters <span class="op">=</span> {  <span class="co"># hyperparameters of each model type</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;GBM&#39;</span>: gbm_options,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&#39;NN&#39;</span>: nn_options, </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>                  }  </span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>num_trials <span class="op">=</span> <span class="dv">3</span>  <span class="co"># try at most 3 different hyperparameter configurations for each type of model</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>search_strategy <span class="op">=</span> <span class="st">&#39;auto&#39;</span>  <span class="co"># tune hyperparameters using Bayesian optimization routine with a local scheduler</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>hyperparameter_tune_kwargs <span class="op">=</span> { </span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;num_trials&#39;</span>: num_trials,</span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;scheduler&#39;</span> : <span class="st">&#39;local&#39;</span>,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">&#39;searcher&#39;</span>: search_strategy,</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>predictor_new_hpo <span class="op">=</span> TabularPredictor(</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">&quot;count&quot;</span>, problem_type<span class="op">=</span><span class="st">&quot;regression&quot;</span>, eval_metric<span class="op">=</span><span class="st">&quot;rmse&quot;</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>    ).fit(</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>    train_data<span class="op">=</span>train.drop([<span class="st">&#39;casual&#39;</span>, <span class="st">&#39;registered&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>),</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    time_limit<span class="op">=</span><span class="dv">600</span>,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>    presets<span class="op">=</span><span class="st">&#39;best_quality&#39;</span>, hyperparameters<span class="op">=</span>hyperparameters, hyperparameter_tune_kwargs<span class="op">=</span>hyperparameter_tune_kwargs)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="d2CBO4Js0NC_" data-outputId="28ab911d-6781-45b3-a368-087cf308df9c">
<div class="sourceCode" id="cb53"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>predictor_new_hpo.fit_summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>*** Summary of fit() ***
Estimated performance of each model:
                      model  score_val  pred_time_val    fit_time  pred_time_val_marginal  fit_time_marginal  stack_level  can_infer  fit_order
0       WeightedEnsemble_L3 -41.282342       5.709038  576.037574                0.000790           0.277052            3       True         10
1        LightGBM_BAG_L2/T0 -41.307625       3.033459  384.648088                0.130620           4.754860            2       True          6
2        LightGBM_BAG_L1/T2 -42.384438       0.139868    4.150900                0.139868           4.150900            1       True          3
3       WeightedEnsemble_L2 -42.384438       0.140630    4.430936                0.000763           0.280037            2       True          5
4        LightGBM_BAG_L1/T0 -42.790304       0.152393    4.254586                0.152393           4.254586            1       True          1
5        LightGBM_BAG_L2/T2 -43.965599       3.033939  384.676854                0.131099           4.783626            2       True          8
6        LightGBM_BAG_L2/T1 -44.192568       3.039248  384.563783                0.136408           4.670555            2       True          7
7        LightGBM_BAG_L1/T1 -55.501303       0.142997    4.189963                0.142997           4.189963            1       True          2
8  NeuralNetMXNet_BAG_L2/T0 -56.404482       5.446529  566.222036                2.543689         186.328808            2       True          9
9  NeuralNetMXNet_BAG_L1/T0 -83.645148       2.467582  367.297780                2.467582         367.297780            1       True          4
Number of models trained: 10
Types of models trained:
{&#39;WeightedEnsembleModel&#39;, &#39;StackerEnsembleModel_LGB&#39;, &#39;StackerEnsembleModel_TabularNeuralNet&#39;}
Bagging used: True  (with 10 folds)
Multi-layer stack-ensembling used: True  (with 3 levels)
Feature Metadata (Processed):
(raw dtype, special dtypes):
(&#39;category&#39;, [])             : 2 | [&#39;season&#39;, &#39;weather&#39;]
(&#39;float&#39;, [])                : 3 | [&#39;temp&#39;, &#39;atemp&#39;, &#39;windspeed&#39;]
(&#39;int&#39;, [])                  : 4 | [&#39;humidity&#39;, &#39;month&#39;, &#39;day&#39;, &#39;hour&#39;]
(&#39;int&#39;, [&#39;bool&#39;])            : 3 | [&#39;holiday&#39;, &#39;workingday&#39;, &#39;year&#39;]
(&#39;int&#39;, [&#39;datetime_as_int&#39;]) : 1 | [&#39;datetime&#39;]
Plot summary of models saved to file: AutogluonModels/ag-20220112_231546/SummaryOfModels.html
*** End of fit() summary ***
</code></pre>
</div>
<div class="output execute_result" data-execution_count="57">
<pre><code>{&#39;leaderboard&#39;:                       model  score_val  ...  can_infer  fit_order
 0       WeightedEnsemble_L3 -41.282342  ...       True         10
 1        LightGBM_BAG_L2/T0 -41.307625  ...       True          6
 2        LightGBM_BAG_L1/T2 -42.384438  ...       True          3
 3       WeightedEnsemble_L2 -42.384438  ...       True          5
 4        LightGBM_BAG_L1/T0 -42.790304  ...       True          1
 5        LightGBM_BAG_L2/T2 -43.965599  ...       True          8
 6        LightGBM_BAG_L2/T1 -44.192568  ...       True          7
 7        LightGBM_BAG_L1/T1 -55.501303  ...       True          2
 8  NeuralNetMXNet_BAG_L2/T0 -56.404482  ...       True          9
 9  NeuralNetMXNet_BAG_L1/T0 -83.645148  ...       True          4
 
 [10 rows x 9 columns],
 &#39;max_stack_level&#39;: 3,
 &#39;model_best&#39;: &#39;WeightedEnsemble_L3&#39;,
 &#39;model_fit_times&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: 4.25458550453186,
  &#39;LightGBM_BAG_L1/T1&#39;: 4.189963340759277,
  &#39;LightGBM_BAG_L1/T2&#39;: 4.150899648666382,
  &#39;LightGBM_BAG_L2/T0&#39;: 4.754860162734985,
  &#39;LightGBM_BAG_L2/T1&#39;: 4.670555114746094,
  &#39;LightGBM_BAG_L2/T2&#39;: 4.783625602722168,
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: 367.2977795600891,
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: 186.32880783081055,
  &#39;WeightedEnsemble_L2&#39;: 0.28003668785095215,
  &#39;WeightedEnsemble_L3&#39;: 0.2770521640777588},
 &#39;model_hyperparams&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;LightGBM_BAG_L1/T1&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;LightGBM_BAG_L1/T2&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;LightGBM_BAG_L2/T0&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;LightGBM_BAG_L2/T1&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;LightGBM_BAG_L2/T2&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: True},
  &#39;WeightedEnsemble_L2&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: False},
  &#39;WeightedEnsemble_L3&#39;: {&#39;max_base_models&#39;: 25,
   &#39;max_base_models_per_type&#39;: 5,
   &#39;save_bag_folds&#39;: True,
   &#39;use_orig_features&#39;: False}},
 &#39;model_paths&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L1/T0/&#39;,
  &#39;LightGBM_BAG_L1/T1&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L1/T1/&#39;,
  &#39;LightGBM_BAG_L1/T2&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L1/T2/&#39;,
  &#39;LightGBM_BAG_L2/T0&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L2/T0/&#39;,
  &#39;LightGBM_BAG_L2/T1&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L2/T1/&#39;,
  &#39;LightGBM_BAG_L2/T2&#39;: &#39;AutogluonModels/ag-20220112_231546/models/LightGBM_BAG_L2/T2/&#39;,
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: &#39;AutogluonModels/ag-20220112_231546/models/NeuralNetMXNet_BAG_L1/T0/&#39;,
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: &#39;AutogluonModels/ag-20220112_231546/models/NeuralNetMXNet_BAG_L2/T0/&#39;,
  &#39;WeightedEnsemble_L2&#39;: &#39;AutogluonModels/ag-20220112_231546/models/WeightedEnsemble_L2/&#39;,
  &#39;WeightedEnsemble_L3&#39;: &#39;AutogluonModels/ag-20220112_231546/models/WeightedEnsemble_L3/&#39;},
 &#39;model_performance&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: -42.79030424903357,
  &#39;LightGBM_BAG_L1/T1&#39;: -55.50130319639482,
  &#39;LightGBM_BAG_L1/T2&#39;: -42.38443789446749,
  &#39;LightGBM_BAG_L2/T0&#39;: -41.307625246122534,
  &#39;LightGBM_BAG_L2/T1&#39;: -44.192567523109574,
  &#39;LightGBM_BAG_L2/T2&#39;: -43.96559898617842,
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: -83.64514828199613,
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: -56.40448174439107,
  &#39;WeightedEnsemble_L2&#39;: -42.38443789446749,
  &#39;WeightedEnsemble_L3&#39;: -41.282341600971606},
 &#39;model_pred_times&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: 0.15239310264587402,
  &#39;LightGBM_BAG_L1/T1&#39;: 0.14299726486206055,
  &#39;LightGBM_BAG_L1/T2&#39;: 0.13986754417419434,
  &#39;LightGBM_BAG_L2/T0&#39;: 0.13061976432800293,
  &#39;LightGBM_BAG_L2/T1&#39;: 0.13640809059143066,
  &#39;LightGBM_BAG_L2/T2&#39;: 0.13109922409057617,
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: 2.4675817489624023,
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: 2.543689250946045,
  &#39;WeightedEnsemble_L2&#39;: 0.000762939453125,
  &#39;WeightedEnsemble_L3&#39;: 0.0007898807525634766},
 &#39;model_types&#39;: {&#39;LightGBM_BAG_L1/T0&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L1/T1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L1/T2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L2/T0&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L2/T1&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;LightGBM_BAG_L2/T2&#39;: &#39;StackerEnsembleModel_LGB&#39;,
  &#39;NeuralNetMXNet_BAG_L1/T0&#39;: &#39;StackerEnsembleModel_TabularNeuralNet&#39;,
  &#39;NeuralNetMXNet_BAG_L2/T0&#39;: &#39;StackerEnsembleModel_TabularNeuralNet&#39;,
  &#39;WeightedEnsemble_L2&#39;: &#39;WeightedEnsembleModel&#39;,
  &#39;WeightedEnsemble_L3&#39;: &#39;WeightedEnsembleModel&#39;},
 &#39;num_bag_folds&#39;: 10}</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="GW3etE2sTIDi" data-outputId="f30bac48-bdee-42e2-e7ce-65114f0f3ba6">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>prediction_new_hpo <span class="op">=</span> predictor_new_hpo.predict(test)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>prediction_new_hpo <span class="op">=</span> {<span class="st">&#39;datetime&#39;</span>: test[<span class="st">&#39;datetime&#39;</span>], <span class="st">&#39;Pred_count&#39;</span>: prediction_new_hpo}</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>prediction_new_hpo <span class="op">=</span> pd.DataFrame(data<span class="op">=</span>prediction_new_hpo)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>prediction_new_hpo.head()</span></code></pre></div>
</div>
<div class="cell code" id="VTSn8XVg0NC_">
<div class="sourceCode" id="cb57"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to set all negative values to zero</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>prediction_new_hpo[prediction_new_hpo[<span class="st">&#39;Pred_count&#39;</span>]<span class="op">&lt;</span><span class="dv">0</span>] <span class="op">=</span> <span class="dv">0</span></span></code></pre></div>
</div>
<div class="cell code" id="xc_Cgcmj0NDA">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same submitting predictions</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>submission_new_hpo <span class="op">=</span> pd.read_csv(<span class="st">&#39;/content/submission.csv&#39;</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>submission_new_hpo[<span class="st">&quot;count&quot;</span>] <span class="op">=</span> prediction_new_hpo[<span class="st">&#39;Pred_count&#39;</span>]</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>submission_new_hpo.to_csv(<span class="st">&quot;submission_new_hpo.csv&quot;</span>, index<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="Wy2Q-W5p0NDA" data-outputId="ddb86ebb-24cd-4129-8b04-821b68921396">
<div class="sourceCode" id="cb59"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submit <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">-</span>f submission_new_hpo.csv <span class="op">-</span>m <span class="st">&quot;new features with hyperparameters&quot;</span></span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="ue9Aya220NDA" data-outputId="e6d4eea5-beca-41e2-d296-0b73d6cdf12f">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>kaggle competitions submissions <span class="op">-</span>c bike<span class="op">-</span>sharing<span class="op">-</span>demand <span class="op">|</span> tail <span class="op">-</span>n <span class="op">+</span><span class="dv">1</span> <span class="op">|</span> head <span class="op">-</span>n <span class="dv">6</span></span></code></pre></div>
</div>
<section id="new-score-of-50893" class="cell markdown"
id="fDsodaTi0NDA">
<h4>New Score of <code>.50893</code></h4>
</section>
<section id="step-7-write-a-report" class="cell markdown"
id="Rg4v9Mql0NDA">
<h2>Step 7: Write a Report</h2>
<h3 id="refer-to-the-markdown-file-for-the-full-report">Refer to the
markdown file for the full report</h3>
<h3 id="creating-plots-and-table-for-report">Creating plots and table
for report</h3>
</section>
<div class="cell code" data-execution_count="37"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:389}"
id="25-X_pXQ0NDA" data-jupyter="{&quot;source_hidden&quot;:true}"
data-outputId="8bf20a1e-9a57-4409-c16d-ebf4a9cea709">
<div class="sourceCode" id="cb61"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taking the top model score from each training run and creating a line plot to show improvement</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You can create these in the notebook and save them to PNG or use some other tool (e.g. google sheets, excel)</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> pd.DataFrame(</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;model&quot;</span>: [<span class="st">&quot;initial&quot;</span>, <span class="st">&quot;add_features&quot;</span>, <span class="st">&quot;hpo&quot;</span>],</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;score&quot;</span>: [<span class="fl">114.633955</span>,  <span class="fl">35.029454</span>, <span class="fl">41.282342</span>]</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>).plot(x<span class="op">=</span><span class="st">&quot;model&quot;</span>, y<span class="op">=</span><span class="st">&quot;score&quot;</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>)).get_figure()</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">&#39;model_train_score.png&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/8c6e24b1132f49a3a186423e41a4d13620238c3d.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="38"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:390}"
id="uElrivwl0NDB" data-outputId="b358fdc2-9b16-4af8-8a87-60d62662047e">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Take the 3 kaggle scores and creating a line plot to show improvement</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> pd.DataFrame(</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;test_eval&quot;</span>: [<span class="st">&quot;initial&quot;</span>, <span class="st">&quot;add_features&quot;</span>, <span class="st">&quot;hpo&quot;</span>],</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;score&quot;</span>: [<span class="fl">1.39920</span>,  <span class="fl">0.47165</span>, <span class="fl">0.50893</span>]</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>).plot(x<span class="op">=</span><span class="st">&quot;test_eval&quot;</span>, y<span class="op">=</span><span class="st">&quot;score&quot;</span>, figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>)).get_figure()</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>fig.savefig(<span class="st">&#39;model_test_score.png&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/9a1595d086ebcd619da1ca152ea85c69c2f3ee3d.png" /></p>
</div>
</div>
<section id="hyperparameter-table" class="cell markdown"
id="yJkkofXW0NDB">
<h3>Hyperparameter table</h3>
</section>
<div class="cell code" data-execution_count="39"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:143}"
id="GWTbT5kN0NDB" data-outputId="fd269a66-abff-4588-ef1d-f9a04f2dadb1">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The 3 hyperparameters we tuned with the kaggle score as the result</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>hyperparams_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;model&quot;</span>: [<span class="st">&quot;initial_model&quot;</span>, <span class="st">&quot;add_features_model&quot;</span>, <span class="st">&quot;hpo_model&quot;</span>],</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hpo1&quot;</span>: [<span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;GBM: num_leaves: lower=26, upper=66&#39;</span>],</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hpo2&quot;</span>: [<span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;NN: dropout_prob: 0.0, 0.5&#39;</span>],</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;hpo3&quot;</span>: [<span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;default_vals&#39;</span>, <span class="st">&#39;GBM: num_boost_round: 100&#39;</span>],</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;score&quot;</span>: [<span class="fl">1.39920</span>,  <span class="fl">0.47165</span>, <span class="fl">0.50893</span>]</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb64"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>hyperparams_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="40">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>hpo1</th>
      <th>hpo2</th>
      <th>hpo3</th>
      <th>score</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>initial_model</td>
      <td>default_vals</td>
      <td>default_vals</td>
      <td>default_vals</td>
      <td>1.39920</td>
    </tr>
    <tr>
      <th>1</th>
      <td>add_features_model</td>
      <td>default_vals</td>
      <td>default_vals</td>
      <td>default_vals</td>
      <td>0.47165</td>
    </tr>
    <tr>
      <th>2</th>
      <td>hpo_model</td>
      <td>GBM: num_leaves: lower=26, upper=66</td>
      <td>NN: dropout_prob: 0.0, 0.5</td>
      <td>GBM: num_boost_round: 100</td>
      <td>0.50893</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell code" data-execution_count="41" id="acDNu6xl_ppr">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_series(time, series, <span class="bu">format</span><span class="op">=</span><span class="st">&quot;-&quot;</span>, start<span class="op">=</span><span class="dv">0</span>, end<span class="op">=</span><span class="va">None</span>, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    plt.plot(time[start:end], series[start:end], <span class="bu">format</span>, label<span class="op">=</span>label)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">&quot;Time&quot;</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">&quot;Value&quot;</span>)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label:</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>        plt.legend(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="42" id="8Pggzdo9A2oI">
<div class="sourceCode" id="cb66"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sub_new <span class="op">=</span> pd.read_csv(<span class="st">&#39;submission_new_features.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell markdown" id="7IYo9T8zTyy5">
<p>Plot time series of train and test data</p>
</div>
<div class="cell code" data-execution_count="43"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:84}"
id="Q_qDLk8V9nO0" data-outputId="a6a2f82c-8d83-4f58-c867-140343d6389f">
<div class="sourceCode" id="cb67"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>series <span class="op">=</span> train[<span class="st">&quot;count&quot;</span>].to_numpy()</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>time <span class="op">=</span> train[<span class="st">&quot;datetime&quot;</span>].to_numpy()</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">350</span>, <span class="dv">15</span>))</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>plot_series(time, series)</span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Train Data time series graph&quot;</span>)</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_series(time1, series1)</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/89272d995388f3df1e75cd14ed3d786e40006b85.png" /></p>
</div>
</div>
<div class="cell code" data-execution_count="44"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:84}"
id="gBAW3aT6DG8x" data-outputId="e1e4b79a-4805-4430-ab8b-64e8b515b856">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sub_new.loc[:, <span class="st">&quot;datetime&quot;</span>] <span class="op">=</span> pd.to_datetime(sub_new.loc[:, <span class="st">&quot;datetime&quot;</span>])</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>series1 <span class="op">=</span> sub_new[<span class="st">&quot;count&quot;</span>].to_numpy()</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>time1 <span class="op">=</span> sub_new[<span class="st">&quot;datetime&quot;</span>].to_numpy()</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">350</span>, <span class="dv">15</span>))</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#plot_series(time, series)</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>plot_series(time1, series1)</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">&quot;Test Data time series graph&quot;</span>)</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_5d9b3fa06baf4684b377395a3387e6b8/4cb1ae40c2bf8ca2ce8bd20f891872c0ca842c1a.png" /></p>
</div>
</div>
<div class="cell markdown" id="KP6zDj8TTsO3">
<p>Prediction with XGBoost</p>
</div>
<div class="cell code" data-execution_count="45" id="B-EfmHUNDVZ-">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="46" id="QqlyXzYtRsJo">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.read_csv(<span class="st">&#39;train.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" data-execution_count="47" id="KSJ6gBqmSGxB">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>test_df <span class="op">=</span> pd.read_csv(<span class="st">&#39;test.csv&#39;</span>)</span></code></pre></div>
</div>
<div class="cell code" id="XQNbkJSLSE-o">
<div class="sourceCode" id="cb72"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>train_df.loc[:, <span class="st">&quot;datetime&quot;</span>] <span class="op">=</span> pd.to_datetime(train_df.loc[:, <span class="st">&quot;datetime&quot;</span>])</span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>test_df.loc[:, <span class="st">&quot;datetime&quot;</span>] <span class="op">=</span> pd.to_datetime(test_df.loc[:, <span class="st">&quot;datetime&quot;</span>])</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> train_df[<span class="st">&#39;datetime&#39;</span>].dt.year</span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;month&#39;</span>] <span class="op">=</span> train_df[<span class="st">&#39;datetime&#39;</span>].dt.month</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;day&#39;</span>] <span class="op">=</span> train_df[<span class="st">&#39;datetime&#39;</span>].dt.day</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;hour&#39;</span>] <span class="op">=</span> train_df[<span class="st">&#39;datetime&#39;</span>].dt.hour</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&#39;year&#39;</span>] <span class="op">=</span> test_df[<span class="st">&#39;datetime&#39;</span>].dt.year</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&#39;month&#39;</span>] <span class="op">=</span> test_df[<span class="st">&#39;datetime&#39;</span>].dt.month</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&#39;day&#39;</span>] <span class="op">=</span> test_df[<span class="st">&#39;datetime&#39;</span>].dt.day</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>test_df[<span class="st">&#39;hour&#39;</span>] <span class="op">=</span> test_df[<span class="st">&#39;datetime&#39;</span>].dt.hour</span></code></pre></div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;,&quot;height&quot;:206}"
id="p4AI9hXZMNo5" data-outputId="b6c0ef62-6628-42b4-9101-4c17f99cd590">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>trainxgb <span class="op">=</span> train_df.drop([<span class="st">&#39;casual&#39;</span>, <span class="st">&#39;registered&#39;</span>,<span class="st">&#39;count&#39;</span>, <span class="st">&#39;datetime&#39;</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>trainxgb.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="39">

  <div id="df-6fef52d6-56a7-453f-a597-a2cdd3a59338">
    <div class="colab-df-container">
      <div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>year</th>
      <th>month</th>
      <th>day</th>
      <th>hour</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>2011</td>
      <td>1</td>
      <td>1</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>
      <button class="colab-df-convert" onclick="convertToInteractive('df-6fef52d6-56a7-453f-a597-a2cdd3a59338')"
              title="Convert this dataframe to an interactive table."
              style="display:none;">
        
  <svg xmlns="http://www.w3.org/2000/svg" height="24px"viewBox="0 0 24 24"
       width="24px">
    <path d="M0 0h24v24H0V0z" fill="none"/>
    <path d="M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z"/><path d="M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z"/>
  </svg>
      </button>
      
  <style>
    .colab-df-container {
      display:flex;
      flex-wrap:wrap;
      gap: 12px;
    }

    .colab-df-convert {
      background-color: #E8F0FE;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: none;
      fill: #1967D2;
      height: 32px;
      padding: 0 0 0 0;
      width: 32px;
    }

    .colab-df-convert:hover {
      background-color: #E2EBFA;
      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);
      fill: #174EA6;
    }

    [theme=dark] .colab-df-convert {
      background-color: #3B4455;
      fill: #D2E3FC;
    }

    [theme=dark] .colab-df-convert:hover {
      background-color: #434B5C;
      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);
      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));
      fill: #FFFFFF;
    }
  </style>

      <script>
        const buttonEl =
          document.querySelector('#df-6fef52d6-56a7-453f-a597-a2cdd3a59338 button.colab-df-convert');
        buttonEl.style.display =
          google.colab.kernel.accessAllowed ? 'block' : 'none';

        async function convertToInteractive(key) {
          const element = document.querySelector('#df-6fef52d6-56a7-453f-a597-a2cdd3a59338');
          const dataTable =
            await google.colab.kernel.invokeFunction('convertToInteractive',
                                                     [key], {});
          if (!dataTable) return;

          const docLinkHtml = 'Like what you see? Visit the ' +
            '<a target="_blank" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'
            + ' to learn more about interactive tables.';
          element.innerHTML = '';
          dataTable['output_type'] = 'display_data';
          await google.colab.output.renderOutput(dataTable, element);
          const docLink = document.createElement('div');
          docLink.innerHTML = docLinkHtml;
          element.appendChild(docLink);
        }
      </script>
    </div>
  </div>
  
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="9cqkxGAZQI11" data-outputId="e9d5bfc1-1a37-4e5f-9d1f-e48e71a4fb8b">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>countxgb <span class="op">=</span> train_df[<span class="st">&#39;count&#39;</span>]</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>countxgb.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="36">
<pre><code>0    16
1    40
2    32
3    13
4     1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div class="cell code"
data-colab="{&quot;base_uri&quot;:&quot;https://localhost:8080/&quot;}"
id="SwO1fcHyL3vW" data-outputId="ed131ea0-66bf-42fd-ae79-15485103f57a">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>train_xgb <span class="op">=</span> xgb.DMatrix(</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    trainxgb, countxgb</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">&quot;objective&quot;</span>: <span class="st">&quot;reg:linear&quot;</span>} <span class="co">#&quot;objective&quot;:&quot;reg:linear&quot;</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>bst <span class="op">=</span> xgb.train(params, train_xgb)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>bst.predict(train_xgb)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>[21:17:55] WARNING: ../src/objective/regression_obj.cu:171: reg:linear is now deprecated in favor of reg:squarederror.
</code></pre>
</div>
<div class="output execute_result" data-execution_count="42">
<pre><code>array([ 35.479843,  31.946043,  25.44875 , ..., 185.26509 , 141.68748 ,
       111.29078 ], dtype=float32)</code></pre>
</div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>jupyter nbconvert <span class="op">--</span>to html bike_sharing.ipynb</span></code></pre></div>
</div>
<div class="cell code">
<div class="sourceCode" id="cb80"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
</body>
</html>
